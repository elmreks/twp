<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Too White Productions</title>
  <meta name="description" content="Too White Productions: chaotic audio dumpzone." />
  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x: hidden;
      background: #0b0b12;
      color: #f7f7ff;
    }

    /* Chaotic background */
    .bg {
      position: fixed; inset: -40vmax;
      background:
        radial-gradient(circle at 12% 20%, rgba(255,0,160,.75), transparent 35%),
        radial-gradient(circle at 80% 10%, rgba(0,255,240,.65), transparent 35%),
        radial-gradient(circle at 70% 80%, rgba(255,240,0,.70), transparent 40%),
        radial-gradient(circle at 20% 85%, rgba(120,70,255,.75), transparent 40%),
        conic-gradient(from 90deg, rgba(255,255,255,.08), rgba(255,255,255,0), rgba(255,255,255,.08));
      filter: blur(14px) saturate(1.35);
      animation: wobble 11s ease-in-out infinite;
      z-index: -3;
    }
    @keyframes wobble {
      0%   { transform: rotate(0deg) scale(1.05); }
      50%  { transform: rotate(9deg) scale(1.18); }
      100% { transform: rotate(0deg) scale(1.05); }
    }

    .noise {
      position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      opacity: .55;
      pointer-events: none;
      z-index: -2;
    }

    .wrap {
      max-width: 1040px;
      margin: 0 auto;
      padding: 22px 16px 80px;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .tag {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      border: 1px solid rgba(255,255,255,.25);
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(8px);
      font-size: 13px;
      opacity: .95;
    }

    /* Marquee that never cuts off */
    .marquee {
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 14px;
      background: rgba(0,0,0,.28);
      overflow: hidden;
      position: relative;
      margin-bottom: 16px;
    }
    .marquee-track {
      display: flex;
      width: max-content;
      white-space: nowrap;
      padding: 10px 0;
      will-change: transform;
      animation: marqueeScroll 20s linear infinite;
    }
    .marquee span {
      display: inline-block;
      padding: 0 16px;
      font-weight: 950;
      letter-spacing: .8px;
      text-transform: uppercase;
      opacity: .95;
    }
    @keyframes marqueeScroll {
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    .hero {
      margin-top: 10px;
      padding: 18px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.18);
      background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(0,0,0,.20));
      box-shadow: 0 22px 80px rgba(0,0,0,.35);
      position: relative;
      overflow: hidden;
    }

    .title {
      margin: 0;
      font-size: clamp(34px, 6vw, 64px);
      line-height: 0.95;
      letter-spacing: -1px;
      font-weight: 1000;
      text-transform: uppercase;
      text-shadow: 0 10px 40px rgba(0,0,0,.55);
    }

    .subtitle {
      margin: 10px 0 0;
      font-size: clamp(14px, 2.2vw, 18px);
      opacity: .9;
      max-width: 72ch;
    }

    .btnrow { display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px; }
    .btn {
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(255,255,255,.06);
      color: inherit;
      padding: 10px 12px;
      border-radius: 14px;
      text-decoration: none;
      font-weight: 900;
      letter-spacing: .3px;
      text-transform: uppercase;
      font-size: 12px;
      transition: transform .14s ease, background .14s ease;
    }
    .btn:hover { transform: translateY(-2px); background: rgba(255,255,255,.10); }

    .grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
      margin-top: 16px;
    }

    .card {
      grid-column: span 12;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.28);
      box-shadow: 0 16px 70px rgba(0,0,0,.28);
      overflow: hidden;
    }

    .card .hd {
      padding: 14px 14px 10px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
      flex-wrap: wrap;
      border-bottom: 1px dashed rgba(255,255,255,.22);
      background: linear-gradient(90deg, rgba(255,0,160,.20), rgba(0,255,240,.14), rgba(255,240,0,.16));
    }

    .card h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 950;
      letter-spacing: .5px;
      text-transform: uppercase;
    }

    .pill {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(8px);
      opacity: .95;
    }

    .tracklist { padding: 12px; display: grid; gap: 12px; }

    .track {
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background:
        radial-gradient(circle at 20% 20%, rgba(255,0,160,.18), transparent 40%),
        radial-gradient(circle at 80% 30%, rgba(0,255,240,.16), transparent 40%),
        radial-gradient(circle at 60% 90%, rgba(255,240,0,.14), transparent 50%),
        rgba(0,0,0,.20);
      transition: transform .18s ease, border-color .18s ease;
      cursor: pointer;
    }
    .track:hover { transform: translateY(-3px) rotate(-.15deg); border-color: rgba(255,255,255,.34); }

    .tracktitle {
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:baseline;
    }
    .tracktitle strong {
      font-size: 20px;
      font-weight: 1000;
      letter-spacing: .2px;
    }
    .badge {
      font-style: normal;
      opacity: .8;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,.18);
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.20);
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .desc { margin-top: 8px; opacity: .9; line-height: 1.35; font-size: 13px; }

    .viewer {
      padding: 12px;
      display: grid;
      gap: 12px;
      border-top: 1px dashed rgba(255,255,255,.22);
      background: rgba(0,0,0,.18);
    }
    .viewer.hidden { display:none; }

    audio { width: 100%; }

    pre {
      margin: 0;
      white-space: pre-wrap;
      word-break: break-word;
      line-height: 1.5;
      font-size: 14px;
      opacity: .95;
    }

    .two { grid-column: span 12; }
    @media (min-width: 900px) { .two { grid-column: span 6; } }

    .rant { padding: 14px; }
    .rant p { margin: 0; line-height: 1.45; opacity: .92; }

    footer {
      margin-top: 20px;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      opacity: .9;
    }

    .tiny { font-size: 12px; opacity: .7; }
    .error { color: #ff5c7a; font-weight: 900; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="noise"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="tag">üß® <b>TOO WHITE PRODUCTIONS</b> <span style="opacity:.7;">// audio dumpzone</span></div>
      <div class="tag">üåÄ <span id="status">vibe: unstable</span></div>
    </div>

    <div class="marquee" aria-hidden="true">
      <div class="marquee-track" id="mqTrack">
        <span>too white productions</span>
        <span>upload tracks / share links / cause problems</span>
        <span>art is a crime scene</span>
        <span>turn volume up / turn dignity down</span>
        <span>no refunds</span>
        <span>unhinged audio archive</span>
      </div>
    </div>

    <section class="hero">
      <h1 class="title">Too White<br/>Productions</h1>
      <p class="subtitle">
        Drop-a-folder. Get-a-link. No platforms. No logins. No vibes police.
        Click a track to preview it right here, or open the track page for the clean link.
      </p>
      <div class="btnrow">
        <a class="btn" href="#drops">Enter the drops</a>
        <a class="btn" href="./tracks/">Open /tracks/</a>
        <a class="btn" href="#how">How it works</a>
      </div>
      <div class="tiny" style="margin-top:10px;">
        Folder format: <code>tracks/YYYY-MM-DD_title/</code> containing <code>index.html</code>, <code>lyrics.txt</code>, <code>song.m4a</code>
      </div>
    </section>

    <div class="grid" id="drops">
      <section class="card">
        <div class="hd">
          <h2>Recent Drops</h2>
          <span class="pill">üéõÔ∏è live list from /tracks</span>
        </div>

        <div class="tracklist" id="trackList">
          <div style="opacity:.8; padding:8px;">Loading tracks‚Ä¶</div>
        </div>

        <div class="viewer hidden" id="viewer">
          <div class="tracktitle">
            <strong id="viewerTitle">‚Äî</strong>
            <span class="badge">
              <span id="viewerDate">‚Äî</span>
              <a id="viewerLink" class="badge" href="#" style="text-decoration:none;">open page ‚Üó</a>
            </span>
          </div>

          <audio id="viewerAudio" controls preload="metadata"></audio>

          <div class="tiny">
            <span>if audio doesn‚Äôt load, you probably named the file wrong. it must be <code>song.m4a</code> (or <code>song.mp3</code>).</span>
          </div>

          <pre id="viewerLyrics">‚Äî</pre>
        </div>
      </section>

      <section class="card two" id="how">
        <div class="hd">
          <h2>How This Works</h2>
          <span class="pill">üì¶ folder = track</span>
        </div>
        <div class="rant">
          <p>
            Each song lives in its own folder inside <b>/tracks/</b>.
            Inside that folder: <b>index.html</b> (the track page), <b>lyrics.txt</b> (the words), and <b>song.m4a</b> (the noise).
            <br/><br/>
            You upload the folder, you get a clean link. The lobby stays loud so the track pages can stay simple.
          </p>
        </div>
      </section>

      <section class="card two">
        <div class="hd">
          <h2>Official Label Policy</h2>
          <span class="pill">‚öñÔ∏è legally: lmao</span>
        </div>
        <div class="rant">
          <p>
            ‚Ä¢ All beats are innocent until proven funky.<br/>
            ‚Ä¢ If you don‚Äôt like it, pretend it‚Äôs ‚Äúconceptual.‚Äù<br/>
            ‚Ä¢ If the page hurts your eyes, that‚Äôs on purpose. Drink water.<br/>
            ‚Ä¢ Too White Productions is fictional, chaotic, and allergic to normal fonts.
          </p>
        </div>
      </section>
    </div>

    <footer>
      <div>¬© <span id="yr"></span> Too White Productions (fictional) ‚Äî hosted on GitHub Pages</div>
      <div class="tiny">operator: <b>elmreks</b></div>
    </footer>
  </div>

  <script>
    document.getElementById("yr").textContent = new Date().getFullYear();

    const statuses = [
      "vibe: unstable",
      "vibe: chaotic neutral",
      "vibe: fluorescent menace",
      "vibe: suspiciously groovy",
      "vibe: glitter threat",
      "vibe: polite disaster"
    ];
    document.getElementById("status").textContent =
      statuses[Math.floor(Math.random() * statuses.length)];

    // Marquee: duplicate content so it never cuts off
    const mq = document.getElementById("mqTrack");
    if (mq && !mq.dataset.duplicated) {
      mq.dataset.duplicated = "true";
      mq.innerHTML = mq.innerHTML + mq.innerHTML;
    }

    // ===== Track listing + preview =====
    const OWNER = "elmreks";
    const REPO  = "twp";
    const TRACKS_PATH = "tracks";
    const TRACK_DIR_REGEX = /^\\d{4}-\\d{2}-\\d{2}[_-]/;

    const basePagesUrl = `${location.origin}/${REPO}/`;

    const trackListEl = document.getElementById("trackList");
    const viewerEl    = document.getElementById("viewer");
    const vTitle      = document.getElementById("viewerTitle");
    const vDate       = document.getElementById("viewerDate");
    const vLink       = document.getElementById("viewerLink");
    const vAudio      = document.getElementById("viewerAudio");
    const vLyrics     = document.getElementById("viewerLyrics");

    const titleFromFolder = (name) =>
      name.replace(/^\\d{4}-\\d{2}-\\d{2}[_-]?/, "")
          .replace(/[_-]+/g, " ")
          .trim() || name;

    const dateFromFolder = (name) => {
      const m = name.match(/^(\\d{4}-\\d{2}-\\d{2})/);
      return m ? m[1] : "‚Äî";
    };

    async function fetchJson(url) {
      const r = await fetch(url, { headers: { "Accept": "application/vnd.github+json" } });
      if (!r.ok) throw new Error(`Fetch failed ${r.status}`);
      return r.json();
    }

    async function loadTracks() {
      const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${TRACKS_PATH}`;
      const items = await fetchJson(api);

      const dirs = items
        .filter(x => x.type === "dir")
        .filter(x => TRACK_DIR_REGEX.test(x.name))
        .sort((a,b) => dateFromFolder(b.name).localeCompare(dateFromFolder(a.name)));

      if (!dirs.length) {
        trackListEl.innerHTML = `<div style="opacity:.8; padding:8px;">No tracks yet.</div>`;
        return;
      }

      trackListEl.innerHTML = dirs.map(d => {
        const date = dateFromFolder(d.name);
        const title = titleFromFolder(d.name);
        const href = `${basePagesUrl}${TRACKS_PATH}/${d.name}/`;
        return `
          <div class="track" data-folder="${d.name}" data-href="${href}">
            <div class="tracktitle">
              <strong>${title}</strong>
              <span class="badge">${date}</span>
            </div>
            <div class="desc">click to preview here ‚Ä¢ or open the track page</div>
          </div>
        `;
      }).join("");

      // click handlers
      [...trackListEl.querySelectorAll(".track")].forEach(el => {
        el.addEventListener("click", async () => {
          const folder = el.dataset.folder;
          const href   = el.dataset.href;

          viewerEl.classList.remove("hidden");
          vTitle.textContent = titleFromFolder(folder);
          vDate.textContent  = dateFromFolder(folder);
          vLink.href = href;

          // Set audio sources (m4a preferred)
          const m4a = `${basePagesUrl}${TRACKS_PATH}/${folder}/song.m4a`;
          const mp3 = `${basePagesUrl}${TRACKS_PATH}/${folder}/song.mp3`;

          vAudio.innerHTML = `
            <source src="${m4a}" type="audio/mp4">
            <source src="${mp3}" type="audio/mpeg">
          `;
          vAudio.load();

          // Load lyrics (from live site path)
          vLyrics.textContent = "Loading lyrics‚Ä¶";
          try {
            const lr = await fetch(`${basePagesUrl}${TRACKS_PATH}/${folder}/lyrics.txt`, { cache: "no-store" });
            if (!lr.ok) throw new Error("lyrics missing");
            const txt = await lr.text();
            vLyrics.textContent = txt.trim() || "(lyrics intentionally blank)";
          } catch (e) {
            vLyrics.innerHTML = `<span class="error">lyrics.txt not found</span>`;
          }

          // Scroll viewer into view
          viewerEl.scrollIntoView({ behavior: "smooth", block: "start" });
        });
      });
    }

    loadTracks().catch(err => {
      trackListEl.innerHTML = `<div class="error" style="padding:8px;">Couldn‚Äôt load /tracks list. ${err.message}</div>`;
      console.error(err);
    });
  </script>
</body>
</html>
